<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公文生成系统</title>
    <style>
        /* 全局重置 */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #f0f2f5;
            display: flex;
            min-height: 100vh;
        }

        /* 左侧控制面板 */
        .control-panel {
            width: 350px;
            background: #fff;
            padding: 20px;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100vh;
            overflow-y: auto;
            position: fixed; /* 固定在左侧 */
            left: 0; top: 0;
            z-index: 100;
        }

        .control-panel h2 { margin-bottom: 10px; font-size: 20px; color: #333; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        .form-group input, .form-group textarea {
            width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
        }
        .form-group textarea { height: 100px; resize: vertical; }

        .btn {
            padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; margin-bottom: 10px;
            transition: background 0.3s;
        }
        .btn-primary { background-color: #1a73e8; color: white; }
        .btn-primary:hover { background-color: #1557b0; }
        .btn-danger { background-color: #d93025; color: white; }
        .btn-danger:hover { background-color: #b02018; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }

        /* 右侧预览区域 */
        .preview-area {
            margin-left: 350px; /* 给左侧面板留出空间 */
            flex: 1;
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 顶部对齐 */
        }

        /* A4 纸张模拟 */
        .a4-paper {
            width: 210mm;
            min-height: 297mm; /* 关键：最小高度为A4，内容多时自动拉长 */
            background: white;
            padding: 20mm 25mm; /* 页边距：上右下左 */
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            /* 移除 height:100% 或 absolute，使用自然流 */
        }

        /* 顶部 Banner */
        .header-img {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 30px; /* Banner与标题的距离 */
        }

        /* 公文标题 */
        .doc-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 40px;
            color: #000;
        }

        /* 正文区域 */
        .doc-body {
            font-size: 18px;
            line-height: 1.8;
            text-align: justify;
            white-space: pre-wrap; /* 保留输入框的换行 */
            margin-bottom: 30px; /* 正文与此致的距离 */
            min-height: 100px; /* 哪怕没字也撑开一点 */
            color: #000;
        }

        /* 此致 */
        .doc-salutation {
            font-size: 18px;
            font-weight: bold;
            text-align: left;
            margin-bottom: 20px;
        }

        /* 落款容器 (核心修改：使用 Flexbox 右对齐，且紧跟上文) */
        .signature-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* 靠右对齐 */
            margin-top: 10px;
            padding-right: 20px;
            position: relative; /* 为了定位印章 */
        }

        /* 签名文字 */
        .sig-text {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
            min-width: 160px; /* 保证对齐美观 */
            z-index: 2; /* 在印章之上 */
            position: relative;
        }

        /* 印章图片 */
        .seal-img {
            position: absolute;
            width: 140px;
            height: 140px;
            top: -40px; /* 向上偏移，盖住一点文字 */
            right: 10px; /* 调整水平位置 */
            opacity: 0.9;
            z-index: 1;
            pointer-events: none;
            display: none; /* 默认隐藏 */
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <h2>公文生成器</h2>
        
        <div class="form-group">
            <label>文件标题</label>
            <input type="text" id="input-title" placeholder="例如：发放通知" value="关于xx的通知">
        </div>

        <div class="form-group">
            <label>此致对象</label>
            <input type="text" id="input-salutation" placeholder="例如：各位会员" value="此致">
        </div>

        <div class="form-group">
            <label>正文内容</label>
            <textarea id="input-content" placeholder="请输入正文...">请在此输入正文内容。无论内容是一行还是五页，下方的落款都会紧紧跟随着正文结束的位置，而不会强行跑到页面底部。</textarea>
        </div>

        <div class="form-group">
            <label>落款署名</label>
            <input type="text" id="input-name" value="阿斯蒂芬">
        </div>

        <div class="form-group">
            <label>落款日期</label>
            <input type="date" id="input-date">
        </div>

        <hr>

        <div class="form-group">
            <label>盖章密码</label>
            <input type="password" id="input-password" placeholder="输入密码显示公章">
        </div>

        <button class="btn btn-primary" onclick="updatePreview()">1. 更新预览</button>
        <button class="btn btn-danger" id="submit-btn" onclick="submitAndSeal()">2. 盖章并提交记录</button>
    </div>

    <div class="preview-area">
        <div class="a4-paper" id="canvas-area">
            
            <img class="header-img" src="banner.jpg" alt="顶部Banner" onerror="alert('Banner图片加载失败！请检查文件名是否为 banner.jpg (全小写) 且已上传。')">

            <div class="doc-title" id="show-title">关于xx的通知</div>

            <div class="doc-body" id="show-body">请在此输入正文内容。</div>

            <div class="doc-salutation" id="show-salutation">此致</div>

            <div class="signature-container">
                <img id="doc-seal" class="seal-img" src="shizi.png" alt="公章">
                
                <div class="sig-text" id="show-name">阿斯蒂芬</div>
                
                <div class="sig-text" id="show-date">2026年1月12日</div>
            </div>

        </div>
    </div>

    <script>
        // 初始化日期
        document.getElementById('input-date').valueAsDate = new Date();

        // 1. 更新预览功能
        function updatePreview() {
            // 获取输入值
            const title = document.getElementById('input-title').value;
            const content = document.getElementById('input-content').value;
            const salutation = document.getElementById('input-salutation').value;
            const name = document.getElementById('input-name').value;
            const dateVal = document.getElementById('input-date').value;

            // 格式化日期
            let formattedDate = "";
            if (dateVal) {
                const d = new Date(dateVal);
                formattedDate = `${d.getFullYear()}年${d.getMonth() + 1}月${d.getDate()}日`;
            }

            // 更新 DOM
            document.getElementById('show-title').innerText = title;
            document.getElementById('show-body').innerText = content;
            document.getElementById('show-salutation').innerText = salutation;
            document.getElementById('show-name').innerText = name;
            document.getElementById('show-date').innerText = formattedDate;

            // 隐藏印章（每次更新时重置）
            document.getElementById('doc-seal').style.display = 'none';
        }

        // 2. 提交并盖章功能
        async function submitAndSeal() {
            const password = document.getElementById('input-password').value;
            const btn = document.getElementById('submit-btn');

            // 简单密码检查 (你需要替换成真实的密码逻辑)
            // 假设密码是 123456
            if (password !== '123456') {
                alert('密码错误，无法盖章！');
                return;
            }

            // 显示处理中
            btn.innerText = "正在提交...";
            btn.disabled = true;

            // 显示印章 (你需要替换下面的 src 为你真实的 base64 印章图片)
            // 这里为了演示，我先让它显示出来。
            const sealImg = document.getElementById('doc-seal');
            // 注意：请将你的真实印章 base64 填入上面的 html img src 中，或者在这里赋值
            // sealImg.src = "data:image/png;base64,......"; 
            sealImg.style.display = 'block';

            // 准备提交到 Google Sheets 的数据
            const payload = {
                title: document.getElementById('input-title').value,
                user: document.getElementById('input-name').value,
                content: document.getElementById('input-content').value
            };

            // Google Apps Script URL (从你的截图中提取的)
            const gasUrl = "https://script.google.com/macros/s/AKfycbwRu5P74s_0LMbIB8u6qo04bX-NGGsGa9l2pc32xz4o16DgDq7RxIYXAGlfTkqbzO_8/exec";

            try {
                await fetch(gasUrl, {
                    method: "POST",
                    mode: "no-cors", // 关键：解决跨域问题
                    body: JSON.stringify(payload)
                });
                
                alert("提交成功！印章已加盖。");
            } catch (error) {
                console.error(error);
                alert("提交到 Google 表格时出错，但印章已加盖。");
            } finally {
                btn.innerText = "2. 盖章并提交记录";
                btn.disabled = false;
            }
        }

        // 页面加载时运行一次预览
        window.onload = updatePreview;
    </script>
</body>
</html>
